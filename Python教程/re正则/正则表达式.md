### 正则表达式

> 常用函数

- `re.match()`从字符串开头匹配,返回`Match`对象或`None`
- `re.search()`搜索第一个匹配位置,返回`Match`对象会`None`
- `re.findall()`搜索所有匹配,返回`列表`
- `re.finditer()`搜索所有匹配,迭代器(返回`Match`对象)
- `re.split()`按正则拆分字符串,返回`列表`
- `re.sub()`替换匹配的内容,返回新字符串
- `re.subn()`替换匹配的内容并返回替换次数,返回元组(新字符串,次数)
- `re.compile()`编译正则表达式,提升性能,返回`pattern`对象

*****

### 匹配模式

```py
import re

pattern = re.compile(r'abc',re.IGNORECASE | re.DOTALL)
```

| **常量**               | **含义**                    |
| ---------------------- | --------------------------- |
| `re.I`/`re.IGNORECASE` | 忽略大小写                  |
| `re.M`/`re.MULTILINE`  | `^`和`$`匹配每行开头/结尾   |
| `re.S`/`re.DOTALL`     | `.`匹配换行符               |
| `re.X`/`re.VERBOSE`    | 忽略正则中的空格和`#`注释   |
| `re.A`/`re.ASCII`      | `\w`,`\b`,`\d`等仅匹配ASCII |
| `re.L`/`re.LOCALE`     | 根据本地语言环境匹配        |

*****

### 元字符

| **符号**        | **含义**                              |
| --------------- | ------------------------------------- |
| `.`             | 匹配任意字符(默认不包括换行)          |
| `^`             | 匹配字符串开头                        |
| `$`             | 匹配字符串结尾                        |
| `*`             | 重复0次或多次                         |
| `+`             | 重复1次或多次                         |
| `?`             | 重复0次或1次(非贪婪时可配合`*?`,`+?`) |
| `{n}`           | 重复n次                               |
| `{n,}`          | 重复至少n次                           |
| `{n,m}`         | 重复n到m次                            |
| `[]`            | 匹配字符集中的任意一个                |
| `[^]`           | 匹配不再字符集中的任意一个            |
| `\`             | 转义特殊字符                          |
| `               | `                                     ||
| `()`            | 分组(捕获)                            |
| `(?:...)`       | 分组(不捕获)                          |
| `(?p<name>...)` | 命名分组                              |
| `(?=...)`       | 正向肯定预查                          |
| `(?!...)`       | 正向否定预查                          |
| `(?<=...)`      | 反向肯定预查                          |
| `(?<!...)`      | 反向否定预查                          |

*****

### 特殊序列

| **序列** | **含义**                   |
| -------- | -------------------------- |
| `\d`     | 数字([0-9])                |
| `\D`     | 非数字                     |
| `\w`     | 单词字符(字母,数字,下划线) |
| `\W`     | 非单词字符                 |
| `\s`     | 空白字符(空格,制表,换行等) |
| `\S`     | 非空白字符                 |
| `\b`     | 单词边界                   |
| `\B`     | 非单词边界                 |

*****

### 常用方法示例

#### 6.1 匹配

```py
import re

m = re.match(r'\d+', '123abc')
if m:
    print(m.group())  # 123
```

#### 6.2 搜索

```py
m = re.search(r'\d+', 'abc123xyz')
print(m.group())  # 123
```

#### 6.3 提取所有

```py
nums = re.findall(r'\d+', 'abc123xyz456')
print(nums)  # ['123', '456']
```

#### 6.4 迭代匹配

```py
for m in re.finditer(r'\d+', 'abc123xyz456'):
    print(m.group(), m.start(), m.end())
```

#### 6.5 分割

```py
parts = re.split(r'[,;]', 'a,b;c')
print(parts)  # ['a', 'b', 'c']
```

#### 6.6 替换

```py
new = re.sub(r'\d+', 'NUM', 'abc123xyz456')
print(new)  # abcNUMxyzNUM
```

------

###  分组与引用

```py
m = re.search(r'(\d+)-(\d+)', '123-456')
print(m.group(1))  # 123
print(m.group(2))  # 456
print(m.groups())  # ('123', '456')
```

命名分组：

```py
m = re.search(r'(?P<first>\d+)-(?P<second>\d+)', '123-456')
print(m.group('first'))  # 123
```

替换中使用分组：

```py
re.sub(r'(\d+)-(\d+)', r'\2-\1', '123-456')  # 456-123
```

------

### 贪婪与非贪婪

```py
text = "<tag>123</tag><tag>456</tag>"
print(re.findall(r'<tag>.*</tag>', text))   # 贪婪 → ['<tag>123</tag><tag>456</tag>']
print(re.findall(r'<tag>.*?</tag>', text))  # 非贪婪 → ['<tag>123</tag>', '<tag>456</tag>']
```

------

### 编译优化

```py
pattern = re.compile(r'\d+')
pattern.findall('abc123xyz456')
```

- **好处**：多次使用同一正则时更快

*****

### 实例

```py
# # -*- encoding: utf-8 -*-
# # TODO:@ModuleName: match
# # TODO:@Author: tomato
# # TODO:@Version: Python3.12.0
# # TODO:@Time: 2025/8/5 17:52
#
# """
# 匹配包含特定sm_text值的HTTP请求块
# :param sm_text_list: 指定要匹配的关键词列表（如 "87", "88"）
# :return: 控制台打印包含sm_text的完整HTTP请求内容
# """
#
# import re
#
# with open("1.txt", "r", encoding="utf-8") as f:
#     content = f.read()
#
# # TODO: 匹配完整HTTP请求块（两个换行分隔）
# requests = re.split(r'\r?\n\r?\n', content)
#
# # TODO: 提取包含"sm_text":""
# sm_text_list = ['87', '104', '101', '93', '102', '90', '91', '89', '88', '92', '103']
#
# for sm_text in sm_text_list:
#     matching_requests = [req for req in requests if f'"sm_text":"{sm_text}' in req]
#
#     # TODO: 输出结果
#     for req in matching_requests:
#         print(req)

# with open("1.txt", "r", encoding="utf-8") as f:
#     lines = f.read()
#
# pattern = lines.split('\n')
# matching_requests = [req for req in pattern if '"sm_text"' in req]
# sms_text_list = ['3', '5', '7', '33']
# for sms_text in sms_text_list:
#     match = [i for i in matching_requests if f'"sm_text":"{sms_text}"' in i]
#     for j in match:
#         print(j)


import re

# TODO: 匹配
match_1 = re.match(r'\d+', '7758258asd')
print(match_1.group())  # 7758258

# TODO: 搜索
match_2 = re.search(r'\d+', '7758258asd')
print(match_2.group())  # 7758258

# TODO: 提取所有
match_3 = re.findall(r'\d+', '7758258asd')
print(match_3[0])  # 7758258

# TODO: 迭代匹配
for m in re.finditer(r'\d+', '7758258asd'):
    print(m.group(), m.start(), m.end())  # 7758258 0 7
    print(m.group()[0:7])  # 7758258

# TODO: 分割
parts = re.split(r'[,;.]', '7.7,58.25;8as;d')
print(parts)  # ['7', '7', '58', '25', '8as', 'd']

# TODO: 替换
new = re.sub(r'\d', 'asd', '7758258asd')
print(new)  # asdasdasdasdasdasdasdasd

# TODO: 分组与引用
match_4 = re.search(r'(\d+)-(\d+)-(\d+)', '028-8750-666')
print(match_4.group(1))  # 028
print(match_4.group(2))  # 8750
print(match_4.group(3))  # 666
print(match_4.groups())  # ('028', '8750', '666')

# TODO: 命名分组
match_5 = re.search(r'(?P<first>\d+)-(?P<second>\d+)-(?P<third>\d+)', '028-8750-666')
print(match_5.group('first'))  # 028
print(match_5.group('second'))  # 8750
print(match_5.group('third'))  # 666

# TODO: 替换分组
replace_example = re.sub(r'(\d+)-(\d+)-(\d+)', r'\3-\2-\1', '028-8750-666')
print(replace_example)  # 666-8750-028

# TODO: 编译优化
pattern = re.compile(r'(\d+)-(\d+)-(\d+)')
pattern.findall("asdasd-666-8750-028-dsddsddddddddddddd")  # 666-8750-028
```

